# TLS settings for Elasticsearch

It's good idea to deploy Elasticsearch cluster with TLS network encription. On Elasticsearch, you have to set this in 2 section:
  - the transport: it's the network traffic used between the node. It's internal traffic and is full managed by operator
  - the API: It's the network traffic to access on Elasticsearch API. It's external traffic and can be full managed by operator. Normally, you should to add ingress with custom cert to access on Elasticsearch from external users / applications.


The operator will create and manage 2 PKI. One for transport and one for API. It will renew automatically certs and publish it with rolling upgrade throught the Elasticsearch nodes (pods)



You can use the following setting:
- **enabled** (boolean): Set to false if you should disable TLS on API access. Default to `true`
- **selfSignedCertificate** (object): Default to `empty`.
  - **altIPs** (slice of string): You can add alternative IPs when operator generate API certificate.
  - **altNames** (slice of string): You can add alternative name when operator generate API certificate.
- **certificateSecretRef** (object): It permit to set custom certificate for API. If you set it, the operator will not managed the life cycle of API certificate. Default to `empty`.
    - **name** (string / require): The secret name.
- **validityDays** (number): It's the number of days that the certificate generated by operator will be valide. Default to `365`
- **renewalDays** (numer): It's the number of days before certificat expire. After that, the operator will renew certificates. Default to `30`.
- **keySize** (number): It's the key size used to generate private keys. Default to `2048`.

**elasticsearch.yaml**
```yaml
apiVersion: elasticsearch.k8s.webcenter.fr/v1
kind: Elasticsearch
metadata:
  labels:
    socle: cluster-dev
  name: elasticsearch
  namespace: cluster-dev
spec:
  tls:
    enabled: true
    keySize: 2048
    renewalDays: 365
    validityDays: 1000
    selfSignedCertificate:
      altIPs:
        - 10.0.0.1
      altNames:
        - my-cluster.domain.local
    certificateSecretRef:
      name: certificat-secret
```

**certificat-secret.yaml**:
```yaml
apiVersion: v1
kind: Secret
metadata:
  name: certificat-secret
  namespace: cluster-dev
type: Opaque
data:
  ca.crt: ++++++++
  tls.crt: ++++++++
  tls.key: ++++++++
```